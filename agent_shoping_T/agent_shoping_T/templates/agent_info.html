{% extends "base.html" %}

{% block title %}ä»£è´­ä¿¡æ¯ - ä»£è´­/è´­ç‰©ç³»ç»Ÿ{% endblock %}

{% block content %}
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-7">
                <!-- ä»£è´­ä¿¡æ¯å¡«å†™å¡ç‰‡ -->
                <div class="card mb-5 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center mb-0 fs-4">ä»£è´­ä¿¡æ¯å¡«å†™</h2>
                    </div>
                    <div class="card-body p-4">
                        <!-- ä¿å­˜ä»£è´­ä¿¡æ¯è¡¨å• -->
                        <form method="POST" action="{{ url_for('agent.agent_info') }}">
                            {{ form.hidden_tag() }}  <!-- CSRF ä»¤ç‰Œä¿æŠ¤ -->

                            <!-- ä»£è´­æ—¶é—´å­—æ®µ -->
                            <div class="mb-4">
                                {{ form.time.label(class="form-label fw-bold text-dark") }}
                                {{ form.time(
                                    class="form-control" + (" is-invalid" if form.time.errors else ""),
                                    placeholder="é€‰æ‹©ä»£è´­æ—¶é—´ï¼ˆå¯é€‰ï¼‰",
                                    value=form.time.data.strftime('%Y-%m-%dT%H:%M') if form.time.data else ""
                                ) }}
                                <div class="form-text text-muted">è¯·é€‰æ‹©è®¡åˆ’ä»£è´­çš„å…·ä½“æ—¶é—´ï¼ˆæ—¥æœŸ+æ—¶æ®µï¼‰ï¼Œä¸é€‰åˆ™é»˜è®¤æ— å›ºå®šæ—¶é—´</div>
                                {% if form.time.errors %}
                                    <div class="invalid-feedback">{{ form.time.errors[0] }}</div>
                                {% endif %}
                            </div>

                            <!-- ä»£è´­åœ°ç‚¹å­—æ®µ -->
                            <div class="mb-4">
                                {{ form.location.label(class="form-label fw-bold text-dark") }}
                                {{ form.location(
                                    class="form-control" + (" is-invalid" if form.location.errors else ""),
                                    placeholder="ä¾‹å¦‚ï¼šXXå•†åœºã€XXçº¿ä¸Šå¹³å°"
                                ) }}
                                <div class="form-text text-muted">è¯·å¡«å†™å‡†ç¡®çš„ä»£è´­åœ°ç‚¹ï¼Œä¾¿äºç”¨æˆ·äº†è§£</div>
                                {% if form.location.errors %}
                                    <div class="invalid-feedback">{{ form.location.errors[0] }}</div>
                                {% endif %}
                            </div>

                            <!-- è¡Œç¨‹å®‰æ’å­—æ®µ -->
                            <div class="mb-4">
                                {{ form.itinerary.label(class="form-label fw-bold text-dark") }}
                                {{ form.itinerary(
                                    class="form-control" + (" is-invalid" if form.itinerary.errors else ""),
                                    rows=5,
                                    placeholder="ä¾‹å¦‚ï¼šä¸Šåˆ10ç‚¹å‰å¾€XXå•†åœºé‡‡è´­ï¼Œä¸‹åˆ3ç‚¹è¿”å›XXå°åŒºï¼Œæ”¯æŒè‡ªææˆ–é€è´§ä¸Šé—¨"
                                ) }}
                                <div class="form-text text-muted">è¯·è¯¦ç»†æè¿°è¡Œç¨‹å®‰æ’ï¼Œè‡³å°‘10ä¸ªå­—ç¬¦ï¼Œå¸®åŠ©ç”¨æˆ·åˆ¤æ–­æ˜¯å¦ç¬¦åˆéœ€æ±‚</div>
                                {% if form.itinerary.errors %}
                                    <div class="invalid-feedback d-block">{{ form.itinerary.errors[0] }}</div>
                                {% endif %}
                            </div>

                            <!-- ä¿å­˜æŒ‰é’® -->
                            <div class="d-grid gap-2">
                                {{ form.save_submit(class="btn btn-primary btn-lg") }}
                            </div>
                        </form>
                    </div>
                </div>

                <!-- å·²ä¿å­˜çš„ä»£è´­ä¿¡æ¯å¡ç‰‡ï¼ˆæœ‰æ•°æ®æ‰æ˜¾ç¤ºï¼‰ -->
                {% if existing_info %}
                    <div class="card shadow-sm">
                        <div class="card-header bg-secondary text-white">
                            <h3 class="text-center mb-0 fs-5">å·²ä¿å­˜çš„ä»£è´­è¡Œç¨‹ä¿¡æ¯</h3>
                        </div>
                        <div class="card-body p-4">
                            <!-- è¡Œç¨‹ä¿¡æ¯å±•ç¤º -->
                            <div class="row g-3 mb-4">
                                <div class="col-12">
                                    <p class="mb-1"><strong class="text-dark">ä»£è´­æ—¶é—´ï¼š</strong>
                                        {{ existing_info.time.strftime('%Y-%m-%d %H:%M') if existing_info.time else "æœªè®¾ç½®å›ºå®šæ—¶é—´" }}
                                    </p>
                                </div>
                                <div class="col-12">
                                    <p class="mb-1"><strong class="text-dark">ä»£è´­åœ°ç‚¹ï¼š</strong>{{ existing_info.location }}</p>
                                </div>
                                <div class="col-12">
                                    <p class="mb-1"><strong class="text-dark">è¡Œç¨‹å®‰æ’ï¼š</strong></p>
                                    <div class="bg-light p-3 rounded border">
                                        {{ existing_info.itinerary | replace('\n', '<br>') | safe }}
                                    </div>
                                </div>
                                <div class="col-12">
                                    <p class="mb-0">
                                        <strong class="text-dark">çŠ¶æ€ï¼š</strong>
                                        {% if existing_info.is_submitted %}
                                            <span class="badge bg-success">å·²åŠ å…¥ä»£è´­åœˆ</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">æœªåŠ å…¥ä»£è´­åœˆ</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
                            <div class="d-flex flex-column gap-3 mt-4">
                                <!-- å·²åŠ å…¥ä»£è´­åœˆï¼šæ˜¾ç¤ºå‰å¾€è´­ç‰©åœˆæŒ‰é’® -->
                                {% if existing_info.is_submitted %}
                                    <a href="{{ url_for('shopping.shopping_circle') }}" class="btn btn-outline-success btn-lg">
                                        å‰å¾€è´­ç‰©åœˆæŸ¥çœ‹å•†å“éœ€æ±‚
                                    </a>
                                {% else %}
                                    <!-- æœªåŠ å…¥ä»£è´­åœˆï¼šæ˜¾ç¤ºåŠ å…¥æŒ‰é’® -->
                                    <form method="POST" action="{{ url_for('agent.agent_info') }}">
                                        {{ submit_form.hidden_tag() }}
                                        <div class="d-grid">
                                            {{ submit_form.join_submit(class="btn btn-success btn-lg") }}
                                        </div>
                                        <small class="text-center d-block mt-2 text-muted">
                                            ç‚¹å‡»åå°†æ‚¨çš„è¡Œç¨‹ä¿¡æ¯åŠ å…¥ä»£è´­åœˆï¼Œå¯æ¥æ”¶ç”¨æˆ·å•†å“éœ€æ±‚
                                        </small>
                                    </form>
                                {% endif %}

                                <!-- ğŸ”¥ åˆ é™¤æŒ‰é’®ï¼šæ˜ç¡®æç¤ºä¼šåˆ é™¤è¡Œç¨‹+ç»‘å®šå…³ç³» -->
                                <form method="POST" action="{{ url_for('agent.agent_info') }}"
                                      onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ\n- ä¼šåˆ é™¤æ‚¨çš„ä»£è´­è¡Œç¨‹æ•°æ®\n- ä¼šè§£é™¤æ‚¨ä¸æ‰€æœ‰ç”¨æˆ·çš„ç»‘å®šå…³ç³»\n- æ‚¨çš„ä»£è´­èº«ä»½ä¸ä¼šæ”¹å˜ï¼Œå¯é‡æ–°å¡«å†™è¡Œç¨‹');">
                                    {{ delete_form.hidden_tag() }}
                                    <div class="d-grid">
                                        {{ delete_form.delete_submit(class="btn btn-danger btn-lg") }}
                                    </div>
                                    <small class="text-center d-block mt-2 text-danger">
                                        è­¦å‘Šï¼šåˆ é™¤åå°†è§£é™¤æ‰€æœ‰ç”¨æˆ·ç»‘å®šå…³ç³»ï¼Œä¸å¯æ¢å¤ï¼
                                    </small>
                                </form>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <!-- æ— è¡Œç¨‹æ•°æ®æ—¶ï¼šæç¤ºç”¨æˆ·å¯å¡«å†™è¡Œç¨‹ -->
                    <div class="alert alert-info text-center">
                        æ‚¨å·²å…·å¤‡ä»£è´­èº«ä»½ï¼Œä½†å°šæœªå¡«å†™ä»£è´­è¡Œç¨‹ä¿¡æ¯<br>
                        å¡«å†™å¹¶ä¿å­˜è¡Œç¨‹åï¼Œå¯åŠ å…¥ä»£è´­åœˆæ¥æ”¶ç”¨æˆ·å•†å“éœ€æ±‚
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    {% block styles %}
        <style>
            .card {
                border-radius: 10px;
            }
            .card-header {
                border-top-left-radius: 10px;
                border-top-right-radius: 10px;
            }
            .btn-lg {
                padding: 0.8rem 1rem;
                font-size: 1.1rem;
            }
            .bg-light.p-3 {
                line-height: 1.8;
            }
            /* é€‚é…æ¢è¡Œçš„æç¤ºæ–‡æ¡ˆ */
            .alert-success br {
                margin-bottom: 0.5rem;
            }
        </style>
    {% endblock %}
{% endblock %}