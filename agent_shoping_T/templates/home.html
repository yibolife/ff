{% extends "base.html" %}

{% block title %}首页 - 代购/购物系统{% endblock %}

{% block content %}
    <div class="jumbotron">
        <h1 class="display-4">欢迎来到代购/购物平台</h1>
        <p class="lead">无论是想找人代购商品，还是想成为代购赚取收益，这里都是你的理想选择</p>
        <hr class="my-4">

        <!-- 未登录用户显示登录/注册按钮（修复路由：添加 auth. 前缀） -->
        {% if not current_user.is_authenticated %}
            <div class="d-flex gap-2">
                <a class="btn btn-primary btn-lg" href="{{ url_for('auth.login') }}" role="button">登录</a>
                <a class="btn btn-success btn-lg" href="{{ url_for('auth.register') }}" role="button">注册</a>
            </div>

        <!-- 已登录用户根据身份显示不同功能按钮（修复路由前缀） -->
        {% else %}
            <div>
                <p class="lead">欢迎回来，{{ current_user.username }}！（{{ '代购用户' if current_user.is_agent else '普通用户' }}）</p>

                <!-- 公共入口：代购圈、购物圈（需确保这些路由已定义，若未定义需先实现） -->
                <div class="d-flex gap-2 mb-3">
                    <a class="btn btn-outline-primary" href="{{ url_for('agent.agent_circle') }}" role="button">进入代购圈</a>
                    {% if current_user.is_agent %}
                        <a class="btn btn-outline-success" href="{{ url_for('shopping.shopping_circle') }}" role="button">进入购物圈</a>
                    {% endif %}
                </div>

                <!-- 身份专属功能按钮（修复路由：添加蓝图前缀） -->
                <div class="d-flex gap-2">
                    {% if current_user.is_agent %}
                        <!-- 代购用户：填写行程 → agent.agent_info 路由 -->
                        <a class="btn btn-warning" href="{{ url_for('agent.agent_info') }}" role="button">
                            <i class="bi bi-box-seam"></i> 填写行程
                        </a>
                        <a class="btn btn-info" href="{{ url_for('agent.contacted_trips') }}" role="button">
                            <i class="bi bi-calendar-plus"></i> 已代购商品
                        </a>
                    {% else %}
                        <!-- 非代购用户：添加商品 → shopping.shopping_info 路由 -->
                        <a class="btn btn-info" href="{{ url_for('shopping.shopping_info') }}" role="button">
                            <i class="bi bi-calendar-plus"></i> 添加商品
                        </a>
                        <a class="btn btn-warning" href="{{ url_for('shopping.purchased_products') }}" role="button">
                            <i class="bi bi-box-seam"></i> 已联系行程
                        </a>
                    {% endif %}
                </div>

                <!-- 身份切换入口（修复路由：auth.choice） -->
                <div class="mt-3">
                    <a class="btn btn-outline-secondary" href="{{ url_for('auth.choose_identity') }}" role="button">
                        <i class="bi bi-exchange"></i> 切换用户身份
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}