{% extends "base.html" %}

{% block title %}绑定详情 - 代购/购物系统{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3>绑定详情</h3>
        </div>
        <div class="card-body">
            <!-- 显示绑定核心信息 -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <p><strong>代购人：</strong>{{ binding.agent.username }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>购物人：</strong>{{ binding.buyer.username }}</p>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <p><strong>绑定状态：</strong>
                        {% if binding.status == 'pending' %}
                            <span class="badge bg-warning">待确认</span>
                        {% elif binding.status == 'confirmed' %}
                            <span class="badge bg-success">已确认</span>
                        {% else %}
                            <span class="badge bg-danger">已取消</span>
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>绑定时间：</strong>{{ binding.created_at.strftime('%Y-%m-%d %H:%M:%S') if binding.created_at else '暂无' }}</p>
                </div>
            </div>

            <!-- 确认绑定按钮：仅待确认状态 + 有权限的用户显示 -->
            {% if binding.status == 'pending' and current_user.id in [binding.agent_id, binding.buyer_id] %}
                <form method="POST" action="{{ url_for('binding.confirm_binding', binding_id=binding.id) }}" class="d-inline">
                    {{ form.hidden_tag() }}
                    <button type="submit" class="btn btn-success mt-3" onclick="return confirm('确定要确认该绑定吗？确认后不可撤销！')">
                        确认绑定
                    </button>
                </form>
            {% endif %}

            <!-- 操作按钮组：仅保留「返回购物圈」按钮，删除「查看所有绑定」按钮 -->
            <div class="mt-3">
                <a href="{{ url_for('shopping.shopping_circle') }}" class="btn btn-outline-primary ms-2">返回购物圈</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}